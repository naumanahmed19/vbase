var Vbase=function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e,r,n,o,s,i){try{var a=t[s](i),c=a.value}catch(t){return void r(t)}a.done?e(c):Promise.resolve(c).then(n,o)}function r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var n,o,s=[],i=!0,a=!1;try{for(r=r.call(t);!(i=(n=r.next()).done)&&(s.push(n.value),!e||s.length!==e);i=!0);}catch(t){a=!0,o=t}finally{try{i||null==r.return||r.return()}finally{if(a)throw o}}return s}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function o(t,e,r,n,o,s,i,a,c,l){"boolean"!=typeof i&&(c=a,a=i,i=!1);const u="function"==typeof r?r.options:r;let d;if(t&&t.render&&(u.render=t.render,u.staticRenderFns=t.staticRenderFns,u._compiled=!0,o&&(u.functional=!0)),n&&(u._scopeId=n),s?(d=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),e&&e.call(this,c(t)),t&&t._registeredComponents&&t._registeredComponents.add(s)},u._ssrRegister=d):e&&(d=i?function(t){e.call(this,l(t,this.$root.$options.shadowRoot))}:function(t){e.call(this,a(t))}),d)if(u.functional){const t=u.render;u.render=function(e,r){return d.call(r),t(e,r)}}else{const t=u.beforeCreate;u.beforeCreate=t?[].concat(t,d):[d]}return r}var s=o({render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"baseform",class:t.labelClass},[r("el-form",{ref:"form",class:t.formClass,attrs:{"label-width":"100%",model:t.form,"label-position":"top",rules:t.formRules,disabled:t.disabled,size:"small"}},[t.networkError?r("el-alert",{staticClass:"my-4",attrs:{title:t.$t("common.msgs.err_network"),type:"error","show-icon":""}}):t._e(),t._v(" "),t.showErrors&&t.validationErors.length>0?r("el-alert",{attrs:{title:"Please fix validation errors",type:"error","show-icon":""}},[r("ul",{staticClass:"p-0"},t._l(t.validationErors.slice().reverse(),(function(e){return r("li",{key:e},[t._v("\n          "+t._s(e)+"\n        ")])})),0)]):t._e(),t._v(" "),t._t("default"),t._v(" "),t.hasActions?t._t("actions"):r("div",{staticClass:"ml-auto mt-3"},[r("el-button",{class:t.btnClass,attrs:{type:"primary",mini:"",plain:"",loading:t.loadingSave,disabled:t.loadingSave},on:{click:function(e){return t.handleSave()}}},[t._v("\n        "+t._s(t.$t(t.submitBtnLabel))+"\n      ")])],1)],2)],1)},staticRenderFns:[]},undefined,{props:{form:{type:Object,required:!0},editMode:{type:Boolean,default:!1},updateMethod:{type:String,default:"patch"},url:{type:String,default:""},updateUrl:{type:String,default:""},labelPosition:{type:String,default:"top"},disabled:{type:Boolean,default:!1},beforeSave:{type:Function,default:function(t){return t}},toastErrors:{type:Boolean,default:!1},showErrors:{type:Boolean,default:!1},errors:{type:Function,default:function(){}},disableUrlGen:{type:Boolean,default:!1},submitBtnLabel:{type:String,default:"common.action.save"},successPostMessage:{type:String,default:"common.msgs.post"},successUpdateMessage:{type:String,default:"common.msgs.update"},hasSidebarForm:{type:Boolean,default:!1},btnClass:{type:String,default:""},formClass:{type:String,default:"capte__form"},rules:{type:Object,default:function(){}}},data:function(){return{loadingSave:!1,editWatchers:[],edited:{},validationErors:[],editing:!1,networkError:!1,formRules:{}}},computed:{labelClass:function(){return{"baseform--top":"top"==this.labelPosition,"baseform--left":"left"==this.labelPosition,"baseform--right":"right"==this.labelPosition}},hasActions:function(){return!!this.$slots.actions}},watch:{form:{handler:function(){var t=this;this.$refs.form&&(Object.keys(this.formRules).forEach((function(e){t.form[e]&&delete t.formRules[e]})),this.$refs.form.validate())},deep:!0,immediate:!0},editMode:{handler:function(t){this.editing=t,t?this.registerWatchers():this.destroyWatchers(),this.edited={}},immediate:!0},editing:{handler:function(t){t?this.registerWatchers():this.destroyWatchers(),this.edited={}},immediate:!0}},mounted:function(){var t=this;this.$events.on("editItem",(function(e){t.editing=!1,t.reset(),t.$nextTick((function(){Object.assign(t.form,e),t.editing=!0,t.$emit("afterFormDataLoaded")}))})),this.$events.on("createItem",(function(){t.editing=!1,t.reset()})),this.$events.on("resetBaseForm",(function(){t.reset()})),Object.assign(this.formRules,this.rules)},methods:{patchURL:function(){var t=this.url;return this.updateUrl?t=this.updateUrl:this.form.id&&!this.disableUrlGen&&(t="".concat(t,"/").concat(this.form.id)),t},clearValidation:function(){this.$refs.form.clearValidate()},destroyWatchers:function(){this.editWatchers.map((function(t){return t()})),this.editWatchers=[]},closeSidebar:function(){this.hasSidebarForm&&this.$events.fire("closeit")},patch:function(){var t=this;return this.clearValidation(),this.$http.patch(this.patchURL(),this.beforeSave(this.edited),{headers:{"Content-Type":" application/merge-patch+json"}}).then((function(){t.edited={},t.$message.success(t.$t(t.successUpdateMessage)),t.$emit("success-update"),t.closeSidebar()})).catch((function(e){t.$emit("errors",e.response.data.errors),"422"==e.response.status?(t.validate(e.response.data.errors),t.form.errors=e.response.data.errors):(t.$message.error(t.$t("common.msgs.error")),t.networkError=!0)}))},put:function(){var t=this;return this.clearValidation(),this.$http.put(this.patchURL(),this.beforeSave(this.form),{headers:{"Content-Type":" application/json"}}).then((function(){t.$message.success(t.$t(t.successUpdateMessage)),t.$emit("success-update"),t.closeSidebar()})).catch((function(e){t.$emit("errors",e.response.data.errors),"422"==e.response.status?t.validate(e.response.data.errors):(t.$message.error(t.$t("common.msgs.error")),t.networkError=!0)}))},reset:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"form";this.$nextTick((function(){void 0!==t.$refs[e]&&t.$refs[e].resetFields()}))},registerWatchers:function(){for(var e in this.form)if("object"===t(this.form[e])&&-1!=["lifecycle"].indexOf(e))for(var r in this.form[e])this.registerWatcher("".concat(e,".").concat(r));else this.registerWatcher(e)},registerWatcher:function(t){this.editWatchers.push(this.$watch("form.".concat(t),(function(e){var r=t.split(".");2==r.length?(r[0]in this.edited||(this.edited[r[0]]={}),this.edited[r[0]][r[1]]=e):1==r.length&&(this.edited[r[0]]="string"==typeof e?""!==e.trim()?e:null:e)}),{deep:!0,immediate:!0}))},scrollToError:function(){document.querySelectorAll(".is-error").length&&document.querySelectorAll(".is-error")[0].scrollIntoView({behavior:"smooth"})},store:function(){var t=this;return this.clearValidation(),this.$http.post(this.url,this.beforeSave(this.form)).then((function(e){t.$message.success(t.$t(t.successPostMessage)),t.$emit("success-save",e.data),t.closeSidebar()})).catch((function(e){t.$emit("errors",e.response.data.errors),"422"==e.response.status?(t.validate(e.response.data.errors),t.toastErrors&&t.errorToast(e.response.data.errors)):t.networkError=!0}))},errorToast:function(t){var e;Object.keys(t).forEach((function(r){e=t[r].join()})),this.$message.warning(e)},validationErrors:function(t){var e,r=this;this.validationErors=[],Object.keys(t).forEach((function(n){e=t[n].join(),r.validationErors.push(e)}))},validate:function(t){var e=this,r={};for(var n in t)r[n]=t[n].map((function(t){return{validator:function(e,r,n){return n(new Error(t))},trigger:"blur",required:!0}}));this.formRules=r,this.showErrors&&this.validationErrors(t),this.$nextTick((function(){return e.scrollToError()}))},handleSave:function(){var t,r=this;return(t=regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.networkError=!1,r.loadingSave=!0,!r.url){t.next=17;break}if(!r.editMode&&!r.editing){t.next=13;break}if("put"!==r.updateMethod){t.next=9;break}return t.next=7,r.put();case 7:t.next=11;break;case 9:return t.next=11,r.patch();case 11:t.next=15;break;case 13:return t.next=15,r.store();case 15:t.next=18;break;case 17:r.$emit("click-button");case 18:r.loadingSave=!1;case 19:case"end":return t.stop()}}),t)})),function(){var r=this,n=arguments;return new Promise((function(o,s){var i=t.apply(r,n);function a(t){e(i,o,s,a,c,"next",t)}function c(t){e(i,o,s,a,c,"throw",t)}a(void 0)}))})()}}},undefined,false,undefined,!1,void 0,void 0,void 0),i=Object.freeze({__proto__:null,BaseForm:s}),a=function(t){Object.entries(i).forEach((function(e){var n=r(e,2),o=n[0],s=n[1];t.component(o,s)}))},c=Object.freeze({__proto__:null,default:a,BaseForm:s});return Object.entries(c).forEach((function(t){var e=r(t,2),n=e[0],o=e[1];"default"!==n&&(a[n]=o)})),a}();